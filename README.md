# Resource Reservation System

## Description

This project is a backend application to manage reservations of business resources such as meeting rooms, vehicles, and equipment.

This backend provides a structured reservation workflow with role-based permissions, capacity handling, and cancellation policies. It includes business logic for hourly and full-day reservations depending on resource type.

It implements a REST API using Django and Django REST Framework.


## Installation & Setup

1. Clone the repository:

```bash
git clone https://github.com/NicoMarina/resource-reservation.git
cd resource-reservation
```

2. Set Up Virtual Environment:

```bash
sudo apt update
sudo apt install python3-venv -y
python3 -m venv venv
source venv/bin/activate
```

### Option 1: Automated Setup with Script

Make the setup script executable (only once):

```bash
chmod +x script/setup.sh
```

Run the script:

```bash
./script/setup.sh
```

This script will:

- Activate the virtual environment.
- Install all dependencies.
- Apply migrations (including auth tokens).
- Run all tests.
- Load sample data (users, resources, reservations).
- Start the Django development server.

Setup script provides full automation for testing and development environment.

### Option 2: Manual Setup

1. Install Dependencies:

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

2. Apply migrations:

```bash
python manage.py makemigrations
python manage.py migrate authtoken
python manage.py migrate
```

3. Load sample data:

```bash
python -m seeds.seed_users
python -m seeds.seed_resources
python -m seeds.seed_reservations
```

4. Run tests:

``` bash
python manage.py test
```

5. Start the development server:

``` bash
python manage.py runserver
```

## API Endpoints

### 1. List All Resources

`GET /api/resources/`

Lists all resources with attributes, type, and image URLs.

### 2. Check Resource Availability

`GET /api/resources/{id}/availability/`

Query parameters:

- date (required, YYYY-MM-DD)
- start_time, end_time (optional, HH:MM)

Returns availability, free slots, capacity used/remaining, and overlapping or pending reservations.

### 3. Create a Reservation

`POST /api/resources/{id}/reservations/`

Request body varies by resource type:

- MeetingRoom: hourly, shared capacity
- Vehicle: full-day
- Equipment: hourly or full-day

Pending reservations are created if the user role cannot auto-approve.

### 4. Approve Pending Reservation

`POST /api/reservations/{id}/approve/`

- Only managers can approve.
- Worker attempts → PermissionDenied

### 5. Cancel a Reservation

`POST /api/reservations/{id}/cancel/`

- Response includes cancelled ID and transferred_to ID (if any).
- Blocked, Moderate, Flexible policies are handled according to the resource’s policy.

## Testing

### 1. Django Unit & Integration Tests

```bash
python manage.py test
```

- Unit tests: cover reservation logic, availability checks, capacity, and policy validation.
- Integration tests: validate interaction between components.

### 2. Postman API Tests

Import the Postman collection included in `docs/Resource_Reservation_API.postman_collection.json` to test all endpoints.

**Environment variables included:**

- `BASE_URL` → e.g., `http://localhost:8000`
- `WORKER_TOKEN` and `MANAGER_TOKEN` → pre-generated by seeds for easy role switching

**Covered Scenarios:**

- **Resources:** `GET /api/resources/` → list all resources  
- **Availability:** check specific resources and time ranges (hourly/full-day, overlapping)
- **Create Reservations:** worker and manager reservations, capacity exceeded, time overlap
- **Approve Reservations:** worker attempts (fail), manager approves pending, manager invalid approvals
- **Cancel Reservations:** manager cancels approved (triggers pending transfer), worker cancels, blocked/moderate policies

Tokens are already created and imported; using the Postman environment allows simple role switching.

### Sample Data (Seeds)

Sample data created via seeds includes:

- Users: Worker and Manager
- Resources: Rooms, Vehicles, Equipment
- Reservations: Partial-day, full-day, overlapping scenarios
- Policies: Flexible, Moderate, Blocked

## Architecture Documentation

A detailed architecture overview and the technical decisions behind this implementation are available in [architecture.md](docs/architecture.md).
